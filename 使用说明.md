# Pancake LP池监控系统 - 使用说明

## 🎯 功能特点

✅ **JSON配置管理** - 通过JSON文件灵活配置监控池  
✅ **指定合约监控** - 精确监控指定合约地址的LP池  
✅ **自动代币识别** - 自动获取LP池中的代币信息  
✅ **TVL实时监控** - 监控流动性总价值变化  
✅ **数据导出** - 支持JSON/CSV格式数据导出  
✅ **变化告警** - 当TVL或代币数量变化超过阈值时告警  

## 🚀 快速开始

### 1. 安装依赖
```bash
pip install -r requirements.txt
```

### 2. 添加要监控的LP池
```bash
# 添加指定的MCH/WBNB池
python pool_manager.py add 0xF8F331DFa811132c43C308757CD802ca982b7211 --name "MCH/WBNB池(0.01%)" --token0 MCH --token1 WBNB --fee "0.01%"

# 添加其他代币池 (示例)
python pool_manager.py add 0x另一个池地址 --name "TOKEN/USDT池" --token0 TOKEN --token1 USDT
```

### 3. 查看配置的池
```bash
python pool_manager.py list
```

### 4. 启动监控
```bash
python simple_main.py
```

## 📋 池管理命令

### 添加池
```bash
python pool_manager.py add [池地址] --name [池名称] --token0 [代币0] --token1 [代币1] --fee [手续费]
```

### 移除池
```bash
python pool_manager.py remove [池地址]
```

### 启用/禁用池
```bash
python pool_manager.py enable [池地址]
python pool_manager.py disable [池地址]
```

### 搜索包含特定代币的池
```bash
python pool_manager.py search MCH
```

## ⚙️ JSON配置说明

配置文件 `config.json` 包含以下主要部分：

### 网络配置
```json
{
  "network": {
    "name": "BSC",
    "chain_id": 56,
    "rpc_url": "https://bsc-dataseed1.binance.org/",
    "explorer": "https://bscscan.com"
  }
}
```

### 监控设置
```json
{
  "monitoring": {
    "interval_seconds": 30,           // 监控间隔(秒)
    "log_changes": true,              // 记录变化
    "save_history": true,             // 保存历史数据
    "alert_threshold_percent": 5.0    // 告警阈值(百分比)
  }
}
```

### 池配置
```json
{
  "pools": [
    {
      "id": "mch_wbnb_001",
      "name": "MCH/WBNB Pool (0.01%)",
      "contract_address": "0xF8F331DFa811132c43C308757CD802ca982b7211",
      "token0": {
        "symbol": "MCH",
        "contract_address": "",
        "decimals": 18
      },
      "token1": {
        "symbol": "WBNB", 
        "contract_address": "0xbb4CdB9CBd36B01bD1cBaEBF2De08d9173bc095c",
        "decimals": 18
      },
      "fee_tier": "0.01%",
      "pool_type": "v3",
      "enabled": true,                // 是否启用监控
      "target_token": "MCH"           // 重点关注的代币
    }
  ]
}
```

### 输出设置
```json
{
  "output": {
    "console_log": true,              // 控制台输出
    "file_log": true,                 // 文件日志
    "log_directory": "./logs",        // 日志目录
    "data_directory": "./data",       // 数据目录
    "export_csv": true,               // 导出CSV
    "export_json": true               // 导出JSON
  }
}
```

## 📊 监控数据

系统会记录以下数据：
- **时间戳** - 数据采集时间
- **池信息** - 池地址、名称、代币对
- **代币数量** - 池中各代币的数量
- **代币价格** - 各代币的USD价格
- **TVL** - 流动性总价值
- **目标代币** - 重点关注代币的详细信息

## 📁 数据存储

监控数据会保存在以下位置：
- **JSON文件**: `./data/lp_data_YYYYMMDD.json`
- **CSV文件**: `./data/lp_data_YYYYMMDD.csv`
- **日志文件**: `./logs/lp_monitor.log`

## 🔔 告警功能

当满足以下条件时会触发告警：
- TVL变化超过设置的阈值百分比
- 目标代币数量变化超过阈值
- 池连接或数据获取出现异常

## 🛠️ 自定义配置

### 修改监控间隔
编辑 `config.json` 中的 `monitoring.interval_seconds`

### 修改告警阈值
编辑 `config.json` 中的 `monitoring.alert_threshold_percent`

### 添加新的代币价格源
在 `simple_main.py` 的 `get_token_price_mock` 方法中添加真实的价格API调用

## 🔍 故障排除

### 常见问题

1. **连接RPC节点失败**
   - 检查网络连接
   - 尝试更换RPC节点URL

2. **获取池数据失败**
   - 确认池地址正确
   - 检查池是否存在且活跃

3. **代币价格为默认值**
   - 当前使用模拟价格，需要集成真实价格API

### 日志查看
```bash
tail -f ./logs/lp_monitor.log
```

## 📈 扩展功能

可以通过以下方式扩展功能：
1. 集成真实价格API (CoinGecko, CoinMarketCap等)
2. 添加更多告警方式 (邮件、钉钉、微信等)
3. 添加图表可视化
4. 集成数据库存储
5. 添加Web界面

## 🤝 贡献

欢迎提交问题和改进建议！
